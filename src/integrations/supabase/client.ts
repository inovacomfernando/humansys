// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL = "https://hdugxslfoujddlbkvvak.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhkdWd4c2xmb3VqZGRsYmt2dmFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyNjMwMzksImV4cCI6MjA2MzgzOTAzOX0.V1CflAVNQGZyjl36gs4mzHY1HxvzrD1_nwXc4zPTTRw";

// Singleton instance to prevent multiple clients
const createSupabaseClient = () => {
  if (typeof window === 'undefined') return null;

  return createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY, {
    auth: {
      autoRefreshToken: true,
      persistSession: true,
      detectSessionInUrl: true,
      storage: window.localStorage,
      storageKey: 'supabase.auth.token',
      flowType: 'pkce'
    },
    global: {
      headers: {
        'X-Client-Info': 'lovable-hr-dashboard'
      }
    },
    realtime: {
      params: {
        eventsPerSecond: 2
      }
    }
  });
};

// Create singleton instance
export const supabase = createSupabaseClient();

// Função auxiliar para verificar conectividade
export const checkSupabaseConnection = async (): Promise<boolean> => {
  if (!supabase) return false;

  try {
    const { error } = await supabase
      .from('profiles')
      .select('id')
      .limit(1);

    return !error;
  } catch (error) {
    console.warn('Connection check failed:', error);
    return false;
  }
};

// Cache para melhorar performance
export const queryCache = new Map();

// Função para limpar cache
export const clearQueryCache = () => {
  queryCache.clear();
  console.log('Query cache cleared');
};

// Função para refresh completo do sistema
export const refreshSystemData = async () => {
  try {
    clearQueryCache();
    localStorage.removeItem('supabase.auth.token');

    // Recarregar a página para garantir estado limpo
    window.location.reload();

    return true;
  } catch (error) {
    console.error('System refresh failed:', error);
    return false;
  }
};